#GigaChat
from langchain.schema import HumanMessage, SystemMessage
from langchain_core.messages import AIMessage
from langchain_gigachat.chat_models.gigachat import GigaChat

#other libs
import asyncio

class MentalResponse:
    @staticmethod
    #–ø–æ–ª—É—á–∞–µ—Ç –∑–∞–ø—Ä–æ—Å –æ—Ç gigaChat —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ —Å–∏—Å—Ç–µ–º—ã(–±–∞–∑–æ–≤—ã–º)
    async def gigachat_response(user_input: str, giga: GigaChat, diaolog: list) -> str:
        bot_messages = [
            SystemMessage(
                content=(
                    "–¢—ã —ç–º–ø–∞—Ç–∏—á–Ω—ã–π –±–æ—Ç-–ø—Å–∏—Ö–æ–ª–æ–≥, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–º–æ–≥–∞–µ—Ç —Å—Ç—É–¥–µ–Ω—Ç—É —Å–ø—Ä–∞–≤–ª—è—Ç—å—Å—è —Å –º–µ–Ω—Ç–∞–ª—å–Ω—ã–º–∏ —Ç—Ä—É–¥–Ω–æ—Å—Ç—è–º–∏: —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å—é, –ø—Ä–æ–∫—Ä–∞—Å—Ç–∏–Ω–∞—Ü–∏–µ–π, –≤—ã–≥–æ—Ä–∞–Ω–∏–µ–º, –æ–¥–∏–Ω–æ—á–µ—Å—Ç–≤–æ–º –∏ –¥—Ä—É–≥–∏–º–∏ –ø–µ—Ä–µ–∂–∏–≤–∞–Ω–∏—è–º–∏. "
                    "–û—Ç–≤–µ—á–∞–π –¥—Ä—É–∂–µ–ª—é–±–Ω–æ, –±–µ—Ä–µ–∂–Ω–æ –∏ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π, –∏–∑–±–µ–≥–∞—è —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–µ–π. "
                    "–¢—ã –ø–æ–º–æ–≥–∞–µ—à—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å –µ–≥–æ –ø—Ä–æ–±–ª–µ–º–∞–º–∏."
                    "–¢—ã –Ω–µ –≤—Ä–∞—á –∏ –Ω–µ –¥–∞—ë—à—å –¥–∏–∞–≥–Ω–æ–∑–æ–≤, –Ω–æ –º–æ–∂–µ—à—å –≤—ã—Å–ª—É—à–∞—Ç—å, –ø—Ä–µ–¥–ª–æ–∂–∏—Ç—å –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, —É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è –Ω–∞ —Ä–∞—Å—Å–ª–∞–±–ª–µ–Ω–∏–µ –∏–ª–∏ –º—è–≥–∫–∏–π —Å–æ–≤–µ—Ç. "
                    "–£ —Ç–µ–±—è –Ω–µ—Ç –ø–∞–º—è—Ç–∏, –ø–æ—ç—Ç–æ–º—É —Ç—ã –Ω–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—à—å –ø—Ä–æ—à–ª—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è. –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–∑–ª–∞–≥–∞—Ç—å –º—ã—Å–ª—å –≤ –∫–∞–∂–¥–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é. "
                    "–¢—ã –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—á–∞—Ç—å –Ω–∞ –∫–∞–∂–¥–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –ø–æ–ª–Ω–æ –∏ –ø–æ–ª–µ–∑–Ω–æ. –ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –æ–±—Ä–∞—â–∞—Ç—å—Å—è –Ω–∞ –í—ã."
                    "–ï—Å–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ–ø–æ–Ω—è—Ç–Ω–æ–µ –∏–ª–∏ –±–µ—Å—Å–º—ã—Å–ª–µ–Ω–Ω–æ–µ ‚Äî –≤–µ–∂–ª–∏–≤–æ –ø–æ–ø—Ä–æ—Å–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞—Ç—å –∑–∞–ø—Ä–æ—Å, —á—Ç–æ–±—ã —Ç—ã –º–æ–≥ –ø–æ–º–æ—á—å."
                )
            ),
            HumanMessage(content=user_input)
        ]
        for chatdict in diaolog:
            bot_messages.append(HumanMessage(content=chatdict['user']))
            bot_messages.append(AIMessage(content=chatdict['bot']))

        bot_messages.append(HumanMessage(content=user_input))
        try:
            bot_res: AIMessage  = await asyncio.wait_for(giga.ainvoke(bot_messages), timeout=5.0)
        except asyncio.TimeoutError:
            bot_res = "–ü–æ–º–æ—â–Ω–∏–∫ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ –¥–æ—Å—Ç—É–ø–µ–Ωüò¥üí§üí§"

        return bot_res.content